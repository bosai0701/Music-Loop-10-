<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MP3 ループ再生（クロスフェード付き）</title>
</head>
<body>

    <audio id="audio" src="10℃_2.mp3"></audio>

    <script>
        const audio = document.getElementById("audio");

        const fadeDuration = 2.5; // フェード時間（秒）
        
        audio.volume = 0;
        audio.play();
        
        function fadeIn() {
            let fadeStep = 0.05;
            let intervalTime = fadeDuration * 1000 / (1 / fadeStep);
            let fadeInInterval = setInterval(() => {
                if (audio.volume < 1) {
                    audio.volume = Math.min(audio.volume + fadeStep, 1);
                } else {
                    clearInterval(fadeInInterval);
                }
            }, intervalTime);
        }

        function fadeOut() {
            let fadeStep = 0.05;
            let intervalTime = fadeDuration * 1000 / (1 / fadeStep);
            let fadeOutInterval = setInterval(() => {
                if (audio.volume > 0) {
                    audio.volume = Math.max(audio.volume - fadeStep, 0);
                } else {
                    audio.currentTime = 0;
                    audio.play();
                    fadeIn();
                    clearInterval(fadeOutInterval);
                }
            }, intervalTime);
        }

        audio.addEventListener("timeupdate", () => {
            if (audio.duration - audio.currentTime <= fadeDuration) {
                fadeOut();
            }
        });

        fadeIn();
    </script>

</body>
</html>
